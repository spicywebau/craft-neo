(()=>{"use strict";var t={n:e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return t.d(i,{a:i}),i},d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=jQuery;var i=t.n(e);const n=Garnish;var s=t.n(n);const o=Craft;var l=t.n(o);const a={_stack:[[]],enter(t,e=!0){if("string"==typeof t&&(t=this.fromFieldName(t)),e){const e=this.getNamespace();e.push(...t),t=e}this._stack.push(t)},enterByFieldName(t,e=!0){this.enter(this.fromFieldName(t),e)},leave(){return this._stack.length>1?this._stack.pop():this.getNamespace()},getNamespace(){return Array.from(this._stack[this._stack.length-1])},parse(t){return"string"==typeof t?t.indexOf("[")>-1?this.fromFieldName(t):t.indexOf("-")>-1?t.split("-"):t.indexOf(".")>-1?t.split("."):t:Array.from(t)},value(t,e="-"){const i=this.getNamespace();return i.push(t),i.join(e)},fieldName(t=""){const e=this.toFieldName();return e?e+t.replace(/([^'"[\]]+)([^'"]*)/,"[$1]$2"):t},toString(t="-"){return this.getNamespace().join(t)},toFieldName(){const t=this.getNamespace();switch(t.length){case 0:return"";case 1:return t[0]}return t[0]+"["+t.slice(1).join("][")+"]"},fromFieldName:t=>t.match(/[^[\]\s]+/g)||[]},r=s().Drag.extend({$container:null,blocks:null,maxTopBlocks:0,_draggeeBlocks:null,init(t,e){void 0===e&&i().isPlainObject(t)&&(e=t,t=null),(e=i().extend({},r.defaults,e)).axis=s().Y_AXIS,this.base(t,e),this.$container=e.container,this.blocks=[],this.maxTopBlocks=e.maxTopBlocks},getHelperTargetX(){return this.$draggee.offset().left},getHelperTargetY(){const t=this.settings.magnetStrength;if(1!==t){const e=this.$draggee.offset().top;return e+(this.mouseY-this.mouseOffsetY-e)/t}return this.base()},getBlockByElement(t){return this.blocks.find((e=>e.$container.is(t)))},getParentBlock(t){const e=t.$container.parent().closest(".ni_block");return e.length>0&&this.getBlockByElement(e)},onDragStart(){const t=this;this._draggeeBlocks=[],this.$draggee.each((function(){t._draggeeBlocks.push(t.getBlockByElement(this))})),this.base(),this._calculateMidpoints()},onDrag(){const t=this._getClosestMidpoint();t&&this._moveDraggeeToBlock(t.block,t.type,t.direction),this.base()},onDragStop(){const t=this;this.$draggee.each((function(){const e=i()(this),n=t.getBlockByElement(e);if(e.parent().is(t.$container))n.setLevel(1);else{const e=t.getParentBlock(n);n.setLevel(e.getLevel()+1)}e.find(".ni_block").each((function(){const e=i()(this),n=t.getBlockByElement(e),s=t.getParentBlock(n);n.setLevel(s.getLevel()+1)}))})),this.returnHelpersToDraggees(),this.base()},addBlock(t){this.blocks.push(t),this.addItems(t.$container)},removeBlock(t){this.blocks=this.blocks.filter((e=>e!==t)),this.removeItems(t.$container)},_getClosestMidpoint(){let t=Number.MAX_VALUE,e=Number.MIN_VALUE,i=null;for(const n of this._currentMidpoints)if(n.direction===r.DIRECTION_UP){this.mouseY-this.mouseOffsetY<n.position&&n.position<t&&(t=n.position,i=n)}else{this.mouseY-this.mouseOffsetY+this._draggeeBlockHeight>n.position&&n.position>e&&(e=n.position,i=n)}return i},_calculateMidpoints(){this._draggeeBlockY=this.$draggee.offset().top,this._draggeeBlockHeight=this.$draggee.height()+10,this._currentMidpoints=[];for(const t of this.blocks)if(0===t.$container.closest(this.$draggee).length){const e=this._getBlockMidpoints(t);for(const i of Object.keys(e)){const n=e[i],s=this._draggeeBlockY>n?r.DIRECTION_UP:r.DIRECTION_DOWN;this._currentMidpoints.push({block:t,position:n,type:i,direction:s})}}const t=this.$container.offset().top+this.$container.height()+5;this._currentMidpoints.push({block:null,position:t,type:r.TYPE_END,direction:r.DIRECTION_DOWN})},_getBlockMidpoints(t){const e={};if(!(t.$container.parent().closest(".ni_block.is-collapsed").length>0)){const i=t.$container.offset().top,n=t.isExpanded(),s=t.$container.height(),o=t.$topbarContainer.height(),l=n?t.$childrenContainer.height():0,a=n&&t.$contentContainer.length>0?t.$childrenContainer.length>0?t.$childrenContainer.offset().top-t.$contentContainer.offset().top:t.$contentContainer.height():0,d=this.getParentBlock(t);if(d&&!this._validateDraggeeChildren(d)||(e[r.TYPE_CONTENT]=i+(o+a)/2),l>0&&t.isExpanded()&&this._validateDraggeeChildren(t)){const n=t.getButtons().$container.height();e[r.TYPE_CHILDREN]=i+s-1-(14+n+10)/2}}return e},_moveDraggeeToBlock:function(t,e=r.TYPE_CONTENT,i=r.DIRECTION_DOWN){const n=t?this.getParentBlock(t):null,s=this._validateDraggeeChildren(n);switch(e){case r.TYPE_CHILDREN:0===this.$draggee.closest(t.$container).length?t.$blocksContainer.append(this.$draggee):s&&t.$container.after(this.$draggee);break;case r.TYPE_END:s&&this.$container.append(this.$draggee);break;default:i===r.DIRECTION_UP?s&&t.$container.before(this.$draggee):t.getBlockType().isParent()&&t.isExpanded()&&this._validateDraggeeChildren(t)?t.$blocksContainer.prepend(this.$draggee):s&&t.$container.after(this.$draggee)}this._updateHelperAppearance(),this._calculateMidpoints()},_validateDraggeeChildren(t){const e=t?t.getField():this._draggeeBlocks[0].getField(),i=e.getMaxLevels();if(i>0){const n=t?t.getLevel():-1,s=this._draggeeBlocks[0].getLevel(),o=t=>t.getLevel()-s+n+1>=i,l=t=>{const i=t.getChildren(e.getBlocks(),!0);return o(t)||i.some(l)};if(this._draggeeBlocks.filter(l).length>0)return!1}if(!t){const t=this,e=this.$container.children(".ni_block:not(.is-disabled)");let i=e.length;for(const t of this._draggeeBlocks)if(!t.getBlockType().getTopLevel())return!1;return e.each((function(){t._draggeeBlocks.includes(t.getBlockByElement(this))&&i--})),!(this.maxTopBlocks>0&&i>=this.maxTopBlocks)}const n=t.getBlockType(),s=n.getMaxChildBlocks(),o=t.$childrenContainer.children(".ni_blocks").children(".ni_block");let l=o.length;const a=[],r=this;if(o.each((function(){const t=r.getBlockByElement(this);r._draggeeBlocks.includes(t)?l--:a.push(t)})),s>0&&l>=s)return!1;const d=[];for(const t of this._draggeeBlocks){if(!n.isValidChildBlock(t))return!1;if(d.includes(t))continue;const e=t.getBlockType(),i=e.getMaxSiblingBlocks();if(0===i)continue;const s=this._draggeeBlocks.filter((t=>t.getBlockType().getHandle()===e.getHandle()));if(a.filter((t=>t.getBlockType().getHandle()===e.getHandle())).length+s.length>i)return!1;d.push(...s)}return!0},_updateHelperAppearance(){for(const t of this.helpers){const e=t.data("neo-b-id"),i=this.blocks.find((t=>t.$container.data("neo-b-id")===e));t.css({width:i.$container.width()+1,height:i.$container.height()})}}},{TYPE_CONTENT:"content",TYPE_CHILDREN:"children",TYPE_END:"end",DIRECTION_UP:"up",DIRECTION_DOWN:"down",defaults:{container:null,magnetStrength:1}}),d=r,c={id:-1,field:null,fieldLayoutId:-1,sortOrder:0,name:"",handle:"",maxBlocks:0,maxSiblingBlocks:0,maxChildBlocks:0,groupChildBlockTypes:!0,childBlocks:!1,topLevel:!0,tabNames:[],hasChildBlocksUiElement:!1,creatableByUser:!0,deletableByUser:!0,editableByUser:!0},h=s().Base.extend({init(t={}){t=Object.assign({},c,t),this._id=0|t.id,this._field=t.field,this._fieldLayoutId=0|t.fieldLayoutId,this._sortOrder=0|t.sortOrder,this._name=t.name,this._handle=t.handle,this._description=t.description,this._enabled=t.enabled,this._minBlocks=0|t.minBlocks,this._maxBlocks=0|t.maxBlocks,this._minSiblingBlocks=0|t.maxSiblingBlocks,this._maxSiblingBlocks=0|t.maxSiblingBlocks,this._minChildBlocks=0|t.minChildBlocks,this._maxChildBlocks=0|t.maxChildBlocks,this._groupChildBlockTypes=t.groupChildBlockTypes,this._childBlocks=t.childBlocks,this._topLevel=t.topLevel,this._tabNames=t.tabNames,this._html=t.tabs?.html??"",this._js=t.tabs?.js??"",this._defaultVisibleLayoutElements=t.tabs?.visibleLayoutElements??{},this._hasChildBlocksUiElement=t.hasChildBlocksUiElement,this._creatableByUser=t.creatableByUser,this._deletableByUser=t.deletableByUser,this._editableByUser=t.editableByUser},getType:()=>"blockType",getId(){return this._id},getFieldLayoutId(){return this._fieldLayoutId},getSortOrder(){return this._sortOrder},getName(){return this._name},getHandle(){return this._handle},getDescription(){return this._description},getEnabled(){return this._enabled},getMinBlocks(){return this._minBlocks},getMaxBlocks(){return this._maxBlocks},getMinSiblingBlocks(){return this._minSiblingBlocks},getMaxSiblingBlocks(){return this._maxSiblingBlocks},getMinChildBlocks(){return this._minChildBlocks},getMaxChildBlocks(){return this._maxChildBlocks},getGroupChildBlockTypes(){return this._groupChildBlockTypes},getChildBlocks(){return this._childBlocks},getTopLevel(){return this._topLevel},getTabNames(){return this._tabNames},async newBlock(t={}){a.enter(this._field.getNamespace());const e={namespace:a.toFieldName(),fieldId:this._field?.getId(),siteId:this._field?.getSiteId(),blocks:[Object.assign({collapsed:!1,enabled:!0,level:1,ownerId:this._field?.getOwnerId(),type:this._id},t)]};a.leave();return(await l().sendActionRequest("POST","neo/input/render-blocks",{data:e})).data.blocks[0]},getDefaultVisibleLayoutElements(){return{...this._defaultVisibleLayoutElements}},getChildBlockItems(t){const e=t.filter((t=>"group"===t.getType()||this.hasChildBlock(t.getHandle())));return e.filter(((t,i)=>{if("group"===t.getType()){const t=e[i+1];return t&&"group"!==t.getType()}return!0}))},isParent(){const t=this.getChildBlocks();return!0===t||"*"===t||Array.isArray(t)&&t.length>0},hasChildBlock(t){const e=this.getChildBlocks();return!0===e||"*"===e||Array.isArray(e)&&e.includes(t)},isValidChildBlock(t){return this.hasChildBlock(t.getBlockType().getHandle())},hasChildBlocksUiElement(){return this._hasChildBlocksUiElement},isCreatableByUser(){return this._creatableByUser},isDeletableByUser(){return this._deletableByUser},isEditableByUser(){return this._editableByUser}}),u={id:-1,sortOrder:0,alwaysShowDropdown:null,name:""},p=s().Base.extend({init(t={}){t=Object.assign({},u,t),this._id=0|t.id,this._sortOrder=0|t.sortOrder,this._alwaysShowDropdown=t.alwaysShowDropdown,this._name=t.name},getType:()=>"group",getId(){return this._id},getSortOrder(){return this._sortOrder},getName(){return this._name},getAlwaysShowDropdown(){return this._alwaysShowDropdown},isBlank(){return!this._name}});const g={namespace:[],blockType:null,tabs:null,id:null,level:1,buttons:null,enabled:!0,collapsed:!1,modified:!0,showButtons:!0,showBlockTypeHandle:!1},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function k(t){return t?t.replace(/[&<>"'/]/g,(t=>b[t])):""}function _(t,e=40){return(t=t||"").length>e?t.slice(0,e-3)+"...":t}const f=s().Base.extend({_templateNs:[],_field:null,_blockType:null,_initialised:!1,_expanded:!0,_enabled:!0,_modified:!0,_initialState:null,_forceModified:!1,_html:null,_js:null,init(t={}){t=Object.assign({},g,t),this._templateNs=a.parse(t.namespace),this._field=t.field,this._blockType=t.blockType,this._blockHtml=t.blockHtml,this._bodyHtml=t.bodyHtml,this._headHtml=t.headHtml,this._id=t.id,this._enabled=t.enabled&&this._blockType.getEnabled(),this._initialEnabled=t.enabled,this._modified=t.modified,this._showButtons=t.showButtons,this._renderOldChildBlocksContainer=!t.blockType.hasChildBlocksUiElement(),this.$container=this._blockHtml?i()(this._blockHtml):this._field.$container.find(`[data-neo-b-id=${this._id}]`),this._uuid=t.uuid??this.$container.data("neo-b-uuid");const e=this.$container.find("[data-neo-b]");this.$bodyContainer=e.filter(`[data-neo-b="${this._id}.container.body"]`),this.$contentContainer=e.filter(`[data-neo-b="${this._id}.container.content"]`),this.$topbarContainer=e.filter(`[data-neo-b="${this._id}.container.topbar"]`),this.$topbarLeftContainer=e.filter(`[data-neo-b="${this._id}.container.topbarLeft"]`),this.$topbarRightContainer=e.filter(`[data-neo-b="${this._id}.container.topbarRight"]`),this.$handleContainer=e.filter(`[data-neo-b="${this._id}.container.handle"]`),this.$tabContainer=this.$contentContainer.children("[data-layout-tab]"),this.$menuContainer=e.filter(`[data-neo-b="${this._id}.container.menu"]`),this.$previewContainer=e.filter(`[data-neo-b="${this._id}.container.preview"]`),this.$settingsButton=e.filter(`[data-neo-b="${this._id}.button.actions"]`),this.$togglerButton=e.filter(`[data-neo-b="${this._id}.button.toggler"]`),this.$enabledInput=e.filter(`[data-neo-b="${this._id}.input.enabled"]`),this.$levelInput=e.filter(`[data-neo-b="${this._id}.input.level"]`),this.$collapsedInput=e.filter(`[data-neo-b="${this._id}.input.collapsed"]`),this.$status=e.filter(`[data-neo-b="${this._id}.status"]`),this.$sortOrder=e.filter(`[data-neo-b="${this._id}.sortOrder"]`),this.$form=this.$container.closest("form"),this.resetButtons(t.buttons);let n=!1;if(this._blockType)for(const t of this._blockType.getTabNames()){const e=`[data-neo-b-info="${t}"]`;this.$tabContainer.filter(e).find("ul.errors").length>0&&(n=!0,this.$tabButton.filter(e).addClass("error"))}this.setLevel(t.level),this.toggleExpansion(!!n||!t.collapsed,!1,!1),this.toggleShowButtons(this._showButtons),this.addListener(this.$topbarContainer,"dblclick","@doubleClickTitle"),this.$container.data("block",this)},initUi(t=!0){if(!this._initialised){if(t&&(l().appendBodyHtml(this._bodyHtml),l().appendHeadHtml(this._headHtml),l().initUiElements(this.$contentContainer)),this.$form=this.$container.closest("form"),this.initTabs(),this._settingsMenu=this.$settingsButton.data("trigger")||new(s().DisclosureMenu)(this.$settingsButton),this._settingsMenu.on("show",(()=>{this._field.getBlocks().filter((t=>t.$container.hasClass("active"))).forEach((t=>t.toggleSettingsMenu(!1))),this.$container.addClass("active")})),this._settingsMenu.on("hide",(()=>this.$container.removeClass("active"))),this.$menuContainer=this._settingsMenu.$container,this.addListener(this.$menuContainer.find("[data-action]"),"click",this._handleActionClick),this.addListener(this.$menuContainer.find("[data-action]"),"keydown",this._handleActionKeydown),this.toggleEnabled(this._initialEnabled),this._initialised=!0,this._buttons?.initUi(),s().requestAnimationFrame((()=>this.updateResponsiveness())),this.$container.on("mousedown",".matrixblock",(function(t){i()(this).addClass("neo-matrixblock")})),this.$container.hasClass("has-errors")&&this.$container.parents(".ni_child-blocks-ui-element").each(((t,e)=>{const n=i()(e).parent(),s=n.closest(".ni_block").data("block"),o=n.index();s.$tabButton.filter(".tab").eq(o).add(s.$tabButton.filter(":not(.tab)").eq(o)).add(s.$container.find("> .ni_block_topbar .tabs_btn")).addClass("has-errors").append(`<span data-icon="alert" aria-label="${l().t("neo","Error")}"></span>`)})),!this.isNew()){this._initialState={enabled:this._enabled,level:this._level,content:this._getPostData()};const t=()=>this._detectChange(),e=new window.MutationObserver((()=>{setTimeout(t,200),this.getBlockType().isEditableByUser()||this.$container.hasClass("is-disabled-for-user")||this.$container.addClass("is-disabled-for-user")}));e.observe(this.$container[0],{attributes:!0,childList:!0,characterData:!0,subtree:!0}),this.$contentContainer.on("propertychange change click","input, textarea, select, div.redactor-in",t),this.$contentContainer.on("paste input keyup",'input:not([type="hidden"]), textarea, div.redactor-in',t),this._detectChangeObserver=e,this.$menuContainer.find('[data-action="copy"], [data-action="paste"], [data-action="duplicate"]').parent().toggleClass("hidden",!this._blockType.getEnabled())}this.$contentContainer,l().CpFieldInspectPlugin&&l().CpFieldInspectPlugin.addFieldLinks(),this.trigger("initUi")}},initTabs(){const t=this.$container.find("[data-neo-b]");this.$tabsButton=t.filter(`[data-neo-b="${this._id}.button.tabs"]`),this.$tabsContainer=t.filter(`[data-neo-b="${this._id}.container.tabs"]`),this.$tabButton=t.filter(`[data-neo-b="${this._id}.button.tab"]`),this.$tabContainer=this.$contentContainer.children("[data-layout-tab]"),this._tabsMenu=this.$tabsButton.data("trigger")||new(s().DisclosureMenu)(this.$tabsButton),this._tabsMenu.on("show",(()=>this.$container.addClass("active"))),this._tabsMenu.on("hide",(()=>this.$container.removeClass("active"))),this.$tabButton=this.$tabButton.add(this._tabsMenu.$container.find(`[data-neo-b="${this._id}.button.tab"]`)),this.addListener(this.$tabButton,"click",this["@setTab"]),this.addListener(this.$tabButton,"keydown",this._handleTabKeydown)},getHtml(){return this._blockHtml.replace(/__NEOBLOCK__/g,this._id)},getJs(){return this._bodyHtml.replace(/__NEOBLOCK__/g,this._id)},destroy(){this._initialised&&(this.$foot?.remove(),clearInterval(this._detectChangeInterval),this._detectChangeObserver&&this._detectChangeObserver.disconnect(),this.trigger("destroy"))},getBlockType(){return this._blockType},getId(){return this._id},getUuid(){return this._uuid},getDuplicatedBlockId(){return this.$form.data("elementEditor")?.draftElementIds[this._id]??this._id},isTopLevel(){return 1===this._level},getLevel(){return this._level},setLevel(t){this._level=0|t,this.$levelInput.val(`0${this._level}`),this.$container.toggleClass("is-level-odd",!!(this._level%2)),this.$container.toggleClass("is-level-even",!(this._level%2))},setModified(t){this._modified=t},getButtons(){return this._buttons},getSiteId(){if(!this._siteId){const t=this.$form.find('input[name="siteId"]');this._siteId=t.val()}return this._siteId},getContent(){const t=this._getPostData(),e={},n=(t,n)=>{let s=e;for(let e=0;e<t.length-1;e++){const n=t[e];i().isPlainObject(s[n])||Array.isArray(s[n])||(s[n]={}),s=s[n]}s[t[t.length-1]]=n};for(const e of Object.keys(t)){const i=a.parse(e).slice(this._templateNs.length+1);if(!i.length)continue;n(i,t[e])}return e},getParent(t=null){t??=this._field.getBlocks();const e=this.getLevel();let i=t.indexOf(this),n=null;if(i>=0&&e>1)for(;null===n&&i>0;){const s=t[--i];s.getLevel()===e-1&&(n=s)}return n},getChildren(t=null,e=null){t??=this._field.getBlocks();const i=this.getLevel();let n=t.indexOf(this);const s=[];if(n>=0){let o=t[++n];for(;o&&o.getLevel()>i;){const l=o.getLevel();(e?l>i:l===i+1)&&s.push(o),o=t[++n]}}return s},getSiblings(t=null){return t??=this._field.getBlocks(),this.isTopLevel()?t.filter((t=>t.isTopLevel())):this.getParent(t).getChildren(t)},getField(){return this._field},updatePreview(t=null){t="boolean"==typeof t&&t;const e=this.$childrenContainer.find(".field"),n=this.$contentContainer.find(".field").add(e),o=[];n.each((function(){const e=i()(this),n=e.children(".input"),a=e.data("type"),r=e.children(".heading").children("label").text();if(null===a)return;let d=!1;switch(a){case"craft\\fields\\Assets":{const e=[],s=n.find(".element");s.each((function(){const n=i()(this),o=n.find(".thumb");let l=o.children("img").prop("srcset");if(l||(l=o.data("srcset")),e.push(`<img sizes="30px" srcset="${l}">`),!t&&1===s.length){const t=n.find(".title").text();e.push(k(_(t)))}})),d=e.join(" ")}break;case"craft\\fields\\Categories":case"craft\\fields\\Entries":case"craft\\fields\\Tags":case"craft\\fields\\Users":{const t=[];n.find(".element").each((function(){const e=i()(this).find(".title, .label").eq(0).text();t.push(k(_(e)))})),d=t.join(", ")}break;case"craft\\fields\\Checkboxes":{const t=[];n.find('input[type="checkbox"]').each((function(){if(this.checked){const e=i()(this).prop("id"),s=n.find(`label[for="${e}"]`).text();t.push(k(_(s)))}})),d=t.join(", ")}break;case"craft\\fields\\Color":{const t=n.find('input[type="color"]').val(),e=n.find('input[type="text"]').val(),i=n.find("div.colorhex").text();let s=null;s=t&&e?`background-color: ${t}`:!t&&e?`background-color: ${e}`:i?`background-color: ${i}`:"background-image: repeating-linear-gradient(-45deg, transparent, transparent 2px, #777 2px, #777 3px)",d=`<div class="preview_color" style="${s}"></div>`}break;case"craft\\fields\\Date":{const t=k(n.find(".datewrapper input").val()),e=k(n.find(".timewrapper input").val());d=t&&e?t+" "+e:t||e}break;case"craft\\fields\\Dropdown":d=k(_(n.find("select").children(":selected").text()));break;case"craft\\fields\\Email":d=k(_(n.children('input[type="email"]').val()));break;case"craft\\fields\\Lightswitch":d=`<span class="status${!!n.find("input").val()?" live":""}"></span>`+k(_(r));break;case"craft\\fields\\MultiSelect":case"ttempleton\\categorygroupsfield\\fields\\CategoryGroupsField":{const t=[];n.find("select").children(":selected").each((function(){t.push(i()(this).text())})),d=k(_(t.join(", ")))}break;case"craft\\fields\\Number":case"craft\\fields\\PlainText":d=k(_(n.children('input[type="text"], textarea').val()));break;case"craft\\fields\\RadioButtons":d=k(_(n.find('input[type="radio"]:checked').closest("label").text()));break;case"craft\\redactor\\Field":case"spicyweb\\tinymce\\fields\\TinyMCE":d=k(_(l().getText(n.find("textarea").val())));break;case"craft\\ckeditor\\Field":d=k(_(l().getText(n.find('[role="textbox"]').html())));break;case"craft\\fields\\Url":d=k(_(n.children('input[type="url"]').val()));break;case"craft\\fields\\Matrix":case"verbb\\supertable\\fields\\SuperTableField":{const t=e.find(".field").find('input[type!="hidden"], select, textarea, .label'),n=[];t.each((function(){const t=i()(this);let e=null;t.is("input, textarea")?e=l().getText(s().getInputPostVal(t)):t.is("select")?e=t.find("option:selected").text():t.hasClass("label")&&(e=t.text()),e&&n.push(_(e))})),d=k(n.join(", "))}break;case"typedlinkfield\\fields\\LinkField":case"presseddigital\\linkit\\fields\\LinkitField":{const t=[],e=n.find("select").children(":selected").first(),i=n.find('.linkfield--typeOption:not(.hidden), [class^="linkit--"]:not(.hidden)'),s=i.find('input[type!="hidden"]').val(),o=i.find(".element"),l=n.find('.field[id*="customText"] input, .linkit--customText input').val();if(t.push(_(e.text())),s&&t.push(_(s)),o.length>0){const e=o.find(".title, .label").eq(0).text();t.push(_(e))}l&&t.push(_(l)),d=k(t.join(", "))}break;case"luwes\\codemirror\\fields\\CodeMirrorField":{const t=[];e.find(".CodeMirror-line > span").each((function(){t.push(i()(this).text())})),d=k(t.join(" "));break}case"rias\\positionfieldtype\\fields\\Position":d=k(n.find(".btn.active").prop("title"));break;case"wrav\\oembed\\fields\\OembedField":d=k(_(n.children("input").val()))}d&&o.length<10&&o.push('<span class="preview_section">',d,"</span>")})),this.$previewContainer.html(o.join(""))},isNew(){return/^new/.test(this.getId())},isSelected(){return this.$container.hasClass("is-selected")},collapse(t,e){this.toggleExpansion(!1,t,e)},expand(t,e){this.toggleExpansion(!0,t,e)},toggleExpansion(t,e,i){if(t="boolean"==typeof t?t:!this._expanded,e="boolean"!=typeof e||e,i=!s().prefersReducedMotion()&&("boolean"!=typeof i||i),t!==this._expanded){this._expanded=t,this._expanded||this.updatePreview();const n=this.$menuContainer.find('[data-action="expand"]').parent(),s=this.$menuContainer.find('[data-action="collapse"]').parent();this.$collapsedInput.val(this._expanded?"":"1"),this.$container.toggleClass("is-expanded",this._expanded).toggleClass("is-collapsed",!this._expanded),n.toggleClass("hidden",this._expanded),s.toggleClass("hidden",!this._expanded),this.$previewContainer.toggleClass("hidden",this._expanded);const o={opacity:1,height:(0|this.$contentContainer.outerHeight())+(0|this.$childrenContainer.outerHeight())},l={opacity:0,height:0},a={opacity:"",height:""};i?this.$bodyContainer.css(this._expanded?l:o).velocity(this._expanded?o:l,"fast",(t=>{this._expanded&&this.$bodyContainer.css(a)})):this.$bodyContainer.css(this._expanded?a:l),e&&this.saveExpansion(),this.trigger("toggleExpansion",{expanded:this._expanded})}},isExpanded(){return this._expanded},saveExpansion(){if(!this.isNew()){const t=this.$form.data("elementEditor")?.settings.isProvisionalDraft?this.getDuplicatedBlockId():this.getId(),e={expanded:this.isExpanded()?1:0,blockId:t,siteId:this.getSiteId()};l().queue.push((()=>new Promise(((t,i)=>{l().sendActionRequest("POST","neo/input/save-expansion",{data:e}).then(t).catch(i)}))))}},disable(){this.toggleEnabled(!1)},enable(){this.toggleEnabled(!0)},toggleEnabled(t=!this._enabled){const e=this._enabled!==t;this._enabled=t;const i=this._blockType.getEnabled(),n=this._enabled&&i,s=this.$menuContainer.find('[data-action="enable"]').parent(),o=this.$menuContainer.find('[data-action="disable"]').parent();this.$container.toggleClass("is-enabled",n).toggleClass("is-disabled",!n),this.$status.toggleClass("hidden",n),s.toggleClass("hidden",this._enabled||!i),o.toggleClass("hidden",!this._enabled||!i),this.$enabledInput.val(this._enabled?"1":""),e&&this.trigger("toggleEnabled",{enabled:this._enabled})},isEnabled(){return this._enabled},toggleShowButtons(t=!this._showButtons){this.$buttonsContainer.toggleClass("hidden",!t),this.$childrenWarningsContainer.toggleClass("hidden",t)},selectTab(t){this.$tabButton.removeClass("is-selected"),this.$tabContainer.addClass("hidden");const e=this.$tabButton.filter(`[data-neo-b-info="${t}"]`).addClass("is-selected"),i=e.attr("data-neo-b-tabuid"),n=this.$tabContainer.filter(`[data-layout-tab="${i}"]`).removeClass("hidden");this.$tabsButton.text(t),l().ElementThumbLoader.retryAll(),this.trigger("selectTab",{tabName:t,$tabButton:e,$tabContainer:n})},updateResponsiveness(){const t=s().isMobileBrowser();this._topbarLeftWidth??=this.$topbarLeftContainer.width()-(this._expanded?0:this.$previewContainer.width())-(t?this.$handleContainer.width():0),this._topbarRightWidth??=this.$topbarRightContainer.width();const e=this.$topbarContainer.width()<this._topbarLeftWidth+this._topbarRightWidth;this.$handleContainer.toggleClass("hidden",t),this.$tabsContainer.toggleClass("invisible",e),this.$tabsButton.toggleClass("invisible",!e)},updateActionsMenu(){const t=this._field.getBlocks(),e=this.getParent()?.getBlockType();let i=e?.getChildBlocks()??this._field.getBlockTypes(!0);!0===i||"*"===i?i=this._field.getBlockTypes(!1):Array.isArray(i)&&(i=i.map((t=>"string"==typeof t?this._field.getBlockTypeByHandle(t):t)).filter((t=>void 0!==t))),i=i.filter((t=>t.isCreatableByUser()));const n=this._field.getName(),s=this._field.getMaxBlocks(),o=1===this._level?this._field.getMaxTopBlocks():0,l=!i||0===i.length,a=this.getBlockType(),r=t.filter((t=>t.getBlockType().getHandle()===a.getHandle())),d=a.getMaxBlocks(),c=this.getSiblings(t),h=t.filter((t=>t.isTopLevel())).length,u=s>0&&t.length>=s||o>0&&h>=o||!1,p=u||l,g=d>0&&r.length>=d;let b=u||g;const k=JSON.parse(window.localStorage.getItem(`neo:copy:${n}`)||"{}");let _=u||!k.blocks||!k.field||k.field!==n;const f=this.getParent(t);if((!_||!b)&&f){const e=f.getBlockType().getMaxChildBlocks();if(e>0){const i=f.getChildren(t).length,n=k.blocks?.length??0;_||=i+n>e,b||=i>=e}}if(!_||!b){const t=this.getBlockType().getMaxSiblingBlocks();if(t>0){const e=t=>Object.prototype.hasOwnProperty.call(t,"type")?t.type===this.getBlockType().getId():"function"==typeof t.getBlockType&&t.getBlockType().getHandle()===this.getBlockType().getHandle(),i=c.filter(e,this).length,n=k.blocks?k.blocks.filter(e,this).length:0;_||=i+n>t,b||=i>=t}}if(!_){const e=t.reduce(((t,e)=>{const i=e.getBlockType(),n=i.getId(),s=t[n]||{blockType:i,count:0};return s.count++,t[n]=s,t}));for(const t of k.blocks){const n=e[t.type];if(n){const t=n.blockType,e=n.count,i=t.getMaxBlocks(),s=i>0&&e>=i;_||=s}1===t.level&&(_||=!i.find((e=>e.getId()===t.type)))}}const m=c.indexOf(this),B=m<=0,$=[-1,c.length-1].includes(m);this.$menuContainer.find('[data-action="moveUp"]').parent().toggleClass("hidden",B),this.$menuContainer.find('[data-action="moveDown"]').parent().toggleClass("hidden",$),this.$menuContainer.find('[data-action="duplicate"]').toggleClass("disabled",b),l?(this.$menuContainer.find('[data-action="add"]').parent().toggleClass("hidden",p),this.$menuContainer.find('[data-action="paste"]').parent().toggleClass("hidden",_)):(this.$menuContainer.find('[data-action="add"]').toggleClass("disabled",p),this.$menuContainer.find('[data-action="paste"]').toggleClass("disabled",_)),this.$menuContainer.children("hr").toggleClass("hidden",0===this.$menuContainer.children("ul:last-child").children("li:not(.hidden)").length)},resetButtons(t){this.$blocksContainer=this.$container.find(`[data-neo-b="${this._id}.container.blocks"]`),this.$buttonsContainer=this.$container.find(`[data-neo-b="${this._id}.container.buttons"]`),this.$childrenContainer=this.$container.find(`[data-neo-b="${this._id}.container.children"]`),this.$childrenWarningsContainer=this.$container.find(`[data-neo-b="${this._id}.container.childrenWarnings"]`),this.$collapsedChildrenContainer=this.$container.find(`[data-neo-b="${this._id}.container.collapsedChildren"]`),this._buttons=null!=t?t:new this._field.ButtonClass({$ownerContainer:this.$container,field:this._field,items:this._blockType.getChildBlockItems(this._field.getItems()),maxBlocks:this._field.getMaxBlocks()}),this._buttons&&(this._buttons.on("newBlock",(t=>this.trigger("newBlock",Object.assign(t,{level:this.getLevel()+1})))),this.$buttonsContainer.append(this._buttons.$container),null===this._buttons.$ownerContainer&&(this._buttons.$ownerContainer=this.$container),this._initialised&&this._buttons.initUi())},namespaceId(t){a.enter(this._templateNs);const e=`${a.toString("-")}-${l().formatInputId(t)}`;return a.leave(),e},toggleSettingsMenu(t){t??=!this._settingsMenu.isExpanded(),t?this._settingsMenu.show():this._settingsMenu.hide()},_handleActionClick(t){t.preventDefault(),this["@settingSelect"](t)},_handleActionKeydown(t){t.keyCode===s().SPACE_KEY&&(t.preventDefault(),this["@settingSelect"](t))},_handleTabKeydown(t){t.keyCode===s().SPACE_KEY&&this["@setTab"](t)},_detectChange(){const t=this.$form.data("elementEditor");if(t?.enableAutosave&&t.settings.draftId&&(this.setModified(!0),this._forceModified=!0),!this._forceModified){const t=this._initialState,e=this._getPostData(),i=!l().compare(e,t.content,!1)||t.enabled!==this._enabled||t.level!==this._level;i!==this._modified&&this.setModified(i)}this.trigger("change")},_getPostData(){const t=s().getPostData(this.$contentContainer),e=Object.keys(t).filter((t=>!t.startsWith(`fields[${this._field.getName()}][blocks][uid:${this._uuid}]`)));for(const i of e)delete t[i];return t},"@settingSelect"(t){this._settingsMenu.hide();const e=t.target.closest("[data-action]");if(!e.classList.contains("disabled"))switch(e.dataset.action){case"collapse":this.collapse();break;case"expand":this.expand();break;case"disable":this.disable(),this.collapse();break;case"enable":this.enable(),this.expand();break;case"moveUp":this.trigger("moveUpBlock",{block:this});break;case"moveDown":this.trigger("moveDownBlock",{block:this});break;case"delete":this.trigger("removeBlock",{block:this});break;case"add":this.trigger("addBlockAbove",{block:this});break;case"copy":this.trigger("copyBlock",{block:this});break;case"paste":this.trigger("pasteBlock",{block:this});break;case"duplicate":this.trigger("duplicateBlock",{block:this})}},"@doubleClickTitle"(t){t.preventDefault();const e=i()(t.target).parent(),n=e.closest(this.$topbarLeftContainer).length>0,s=e.closest(this.$topbarRightContainer).length>0;n||s||(this.$form.data("elementEditor")?.pause(),this.toggleExpansion(),this.$form.data("elementEditor")?.resume())},"@setTab"(t){t.preventDefault(),this._tabsMenu.hide();const e=i()(t.currentTarget).attr("data-neo-b-info");this.selectTab(e)}}),m={$ownerContainer:null,blockTypes:[],groups:[],items:null,maxBlocks:0,maxTopBlocks:0,blocks:null};class B{static BUTTON_INFO="data-neo-bn-info";_blockTypes=[];_blockTypeGroups=[];constructor(t={}){(t=Object.assign({},m,t)).items?(this._items=Array.from(t.items),this._blockTypes=this._items.filter((t=>"blockType"===t.getType())),this._blockTypeGroups=this._items.filter((t=>"group"===t.getType()))):(this._blockTypes=Array.from(t.blockTypes),this._blockTypeGroups=Array.from(t.groups),this._items=[...this._blockTypes,...this._blockTypeGroups].sort(((t,e)=>t.getSortOrder()-e.getSortOrder()))),this.$ownerContainer=t.$ownerContainer,this._field=t.field,this._maxBlocks=0|t.maxBlocks,this._maxTopBlocks=0|t.maxTopBlocks,this.$container=this.renderButtons();const e=this.$container.find("[data-neo-bn]");this.$buttonsContainer=e.filter('[data-neo-bn="container.buttons"]'),this.$menuContainer=e.filter('[data-neo-bn="container.menu"]'),this.$blockButtons=e.filter('[data-neo-bn="button.addBlock"]'),this.$groupButtons=e.filter('[data-neo-bn="button.group"]'),t.blocks&&this.updateState(t.blocks)}renderButtons(){const t=this.$ownerContainer?.hasClass("ni_block")?this.$ownerContainer.attr("class").match(/ni_block--([^\s]+)/)[1]:null,e=null!==t&&!this.getField().getBlockTypeByHandle(t).getGroupChildBlockTypes(),n=[];let s=[],o=null,a=!0;const r=()=>{n.push(`\n          <div class="btn dashed${a?" add icon":""} menubtn" data-neo-bn="button.group">\n            ${o.getName()}\n          </div>\n          <div class="menu">\n            <ul>${s.join("")}\n            </ul>\n          </div>`),a=!1,s=[]};n.push('\n      <div class="ni_buttons">\n        <div class="btngroup" data-neo-bn="container.buttons">');for(let t=0;t<this._items.length;t++){const i=this._items[t],l=i.getType();if("blockType"===l){if(!i.getEnabled()||!i.isCreatableByUser())continue;const t=i.getDescription()?` title="${i.getDescription()}"`:"";null!==o?s.push(`\n            <li>\n              <a${t} aria-label="${i.getName()}" data-neo-bn="button.addBlock" ${B.BUTTON_INFO}="${i.getHandle()}">${i.getName()}</a>\n            </li>`):(n.push(`\n          <button${t} aria-label="${i.getName()}" class="btn dashed${a?" add icon":""}" data-neo-bn="button.addBlock" ${B.BUTTON_INFO}="${i.getHandle()}">\n            ${i.getName()}\n          </button>`),a=!1)}else"group"===l&&(null!==o&&s.length>0&&r(),o=i.isBlank()||!i.getAlwaysShowDropdown()&&(t+2>=this._items.length||"group"===this._items[t+2].getType())||e?null:i)}null!==o&&s.length>0&&r(),n.push(`\n        </div>\n        <div class="btn dashed add icon menubtn hidden" data-neo-bn="container.menu">\n          ${l().t("neo","Add a block")}\n        </div>`),o=null;let d=!1;n.push('\n        <div class="menu">\n          <ul>');for(const t of this._items){const i=t.getType();if("blockType"===i){if(!t.getEnabled()||!t.isCreatableByUser())continue;null===o||d||(d=!0,n.push(`\n              <h6>${o.getName()}</h6>\n              <ul class="padded">`));const e=t.getDescription()?` title="${t.getDescription()}"`:"";n.push(`\n            <li>\n              <a${e} aria-label="${t.getName()}" data-neo-bn="button.addBlock" ${B.BUTTON_INFO}="${t.getHandle()}">\n                ${t.getName()}\n              </a>\n            </li>`)}else"group"===i&&((null===o||d)&&n.push("\n              </ul>"),d=!1,o=t.isBlank()||e?null:t,null===o&&n.push("\n              <ul>"))}return n.push("\n          </ul>\n        </div>\n      </div>"),i()(n.join(""))}getField(){return this._field}getBlockTypes(){return Array.from(this._blockTypes)}getBlockTypeGroups(){return Array.from(this._blockTypeGroups)}getBlockTypeByButton(t){const e=t.attr(B.BUTTON_INFO);return this._blockTypes.find((t=>t.getHandle()===e))}updateState(t=[],e=null,n=null){e="boolean"!=typeof e||e;const s=this,o=t.filter((t=>t.isTopLevel())).length,l=this._maxBlocks>0&&t.length>=this._maxBlocks,a=this._maxTopBlocks>0&&o>=this._maxTopBlocks,r=l||a||!e;this.$blockButtons.each((function(){const e=i()(this);let o=r;if(!o){const i=t=>t.getBlockType().getHandle()===l.getHandle(),l=s.getBlockTypeByButton(e),a=t.filter(i),r=l.getMaxBlocks(),d=l.getMaxSiblingBlocks(),c=null!==n?n.getChildren(t).filter(i):t.filter((t=>t.isTopLevel()&&t.getBlockType().getHandle()===l.getHandle()));o||=r>0&&a.length>=r||d>0&&c.length>=d}e.toggleClass("disabled",o)})),this.$groupButtons.each((function(){const t=i()(this),e=t.data("menubtn");let n=r;if(!n&&e){const t=e.menu.$options;n=t.length===t.filter(".disabled").length}t.toggleClass("disabled",n)}))}updateResponsiveness(){}}const $=s().Base.extend({init(t){this._buttons=t,this.$container=this._buttons.$container,this.addListener(this._buttons.$blockButtons,"activate","@newBlock")},initUi(){this._buttons.initUi()},getBlockTypes(){return this._buttons.getBlockTypes()},getGroups(){return this._buttons.getBlockTypeGroups()},getMaxBlocks(){return this._maxBlocks},updateButtonStates(t=[],e=null,i=null){this._buttons.updateState(t,e,i)},updateState(t=[],e=null,i=null){this._buttons.updateState(t,e,i)},updateResponsiveness(){this._buttons.updateResponsiveness()},getBlockTypeByButton(t){return this._buttons.getBlockTypeByButton(t)},"@newBlock"(t){const e=i()(t.currentTarget).attr(B.BUTTON_INFO),n=this._buttons.getBlockTypes().find((t=>t.getHandle()===e));this.trigger("newBlock",{blockType:n})}});class y extends B{initUi(){if(i()(".menubtn",this.$container).menubtn(),this.updateResponsiveness(),0===this.$buttonsContainer.children().length){const t=this.$container.parent(),e=t.parent(),i=e.children(".ni_blocks");0===i.length||0===i.children().length?e.addClass("hidden"):t.addClass("hidden")}}updateResponsiveness(){this._buttonsContainerWidth||=this.$buttonsContainer.width();const t=this.$container.width()<this._buttonsContainerWidth;this.$buttonsContainer.toggleClass("hidden",t),this.$menuContainer.toggleClass("hidden",!t)}}const C=$.extend({init(t={}){this.base(new y(t))}});class v extends B{renderButtons(){const t=this.$ownerContainer?.hasClass("ni_block")?this.$ownerContainer.attr("class").match(/ni_block--([^\s]+)/)[1]:null,e=null!==t&&!this.getField().getBlockTypeByHandle(t).getGroupChildBlockTypes(),n=[];let s=null;n.push(`\n        <div class="ni_buttons">\n          <div class="btn dashed add icon menubtn" data-neo-bn="container.menu">\n            ${l().t("neo","Add a block")}\n          </div>`),s=null;let o=!1;n.push('\n          <div class="menu ni_newblockgrid" data-neo-bn="container.buttons">');for(const t of this._items){const i=t.getType();if("blockType"===i){if(!t.getEnabled()||!t.isCreatableByUser())continue;o||(o=!0,null!==s&&n.push(`\n            <h6>${s.getName()}</h6>`),n.push('\n            <ul class="padded">'));const e=t.getDescription()?` title="${t.getDescription()}"`:"",i=`fields-ni-icon-${this.getField().getName()}-${t.getHandle()}`,l=this._field?.$container.closest("form").find(`#${i}`).length>0??!1;n.push(`\n              <li>\n                <a${e} aria-label="${t.getName()}" data-neo-bn="button.addBlock" ${B.BUTTON_INFO}="${t.getHandle()}">`),l?n.push(`\n                  <svg class="ni_newblockgrid_icon">\n                    <use href="#${i}"></use>\n                  </svg>`):n.push('\n                  <div class="ni_newblockgrid_icon defaulticon">\n                  </div>'),n.push(`\n                  <span>${t.getName()}</span>\n                </a>\n              </li>`)}else"group"===i&&(o&&n.push("\n            </ul>"),o=!1,s=t.isBlank()||e?null:t)}return n.push("\n          </ul>\n        </div>\n      </div>"),i()(n.join(""))}initUi(){if(i()(".menubtn",this.$container).menubtn(),this.updateResponsiveness(),0===this.$buttonsContainer.find('[data-neo-bn="button.addBlock"]').length){const t=this.$container.parent(),e=t.parent(),i=e.children(".ni_blocks");0===i.length||0===i.children().length?e.addClass("hidden"):t.addClass("hidden")}}}const T=$.extend({init(t={}){this.base(new v(t))}});class x extends B{renderButtons(){const t=this.$ownerContainer?.hasClass("ni_block")?this.$ownerContainer.attr("class").match(/ni_block--([^\s]+)/)[1]:null,e=null!==t&&!this.getField().getBlockTypeByHandle(t).getGroupChildBlockTypes(),n=[];let s=null;n.push(`\n      <div class="ni_buttons">\n        <div class="btn dashed add icon menubtn" data-neo-bn="container.menu">\n          ${l().t("neo","Add a block")}\n        </div>`);let o=!1;n.push('\n        <div class="menu ni_newblocklist" data-neo-bn="container.buttons">');for(const t of this._items){const i=t.getType();if("blockType"===i){if(!t.getEnabled()||!t.isCreatableByUser())continue;o||(o=!0,null!==s&&n.push(`\n            <h6>${s.getName()}</h6>`),n.push('\n            <ul class="padded">'));const e=t.getDescription()?` title="${t.getDescription()}"`:"",i=`fields-ni-icon-${this.getField().getName()}-${t.getHandle()}`,l=this._field?.$container.closest("form").find(`#${i}`).length>0??!1;n.push(`\n              <li>\n                <a${e} class="flex" aria-label="${t.getName()}" data-neo-bn="button.addBlock" ${B.BUTTON_INFO}="${t.getHandle()}">`),l?n.push(`\n                  <svg class="ni_newblocklist_icon">\n                    <use href="#${i}"></use>\n                  </svg>`):n.push('\n                  <div class="ni_newblocklist_icon defaulticon">\n                  </div>'),n.push(`\n                  <span>${t.getName()}</span>\n                </a>\n              </li>`)}else"group"===i&&(o&&n.push("\n            </ul>"),o=!1,s=t.isBlank()||e?null:t)}return n.push("\n          </ul>\n        </div>\n      </div>"),i()(n.join(""))}initUi(){if(i()(".menubtn",this.$container).menubtn(),this.updateResponsiveness(),0===this.$buttonsContainer.find('[data-neo-bn="button.addBlock"]').length){const t=this.$container.parent(),e=t.parent(),i=e.children(".ni_blocks");0===i.length||0===i.children().length?e.addClass("hidden"):t.addClass("hidden")}}}const w=$.extend({init(t={}){this.base(new x(t))}}),I={name:null,namespace:[],blockTypes:[],groups:[],blocks:[],inputId:null,maxBlocks:0,maxTopBlocks:0,minLevels:0,maxLevels:0,ownerId:null},E=s().Base.extend({_templateNs:[],_name:null,_siteId:null,_visibleLayoutElements:{},_newBlockCount:0,init(t={}){t=Object.assign({},I,t),this._templateNs=a.parse(t.namespace),this._blockTypes=[],this._groups=t.groups.map((t=>new p(t))),this._blocks=[],this._id=t.id,this._name=t.name,this._minBlocks=t.minBlocks,this._maxBlocks=t.maxBlocks,this._maxTopBlocks=t.maxTopBlocks,this._minLevels=t.minLevels,this._maxLevels=t.maxLevels,this._ownerId=t.ownerId,this._showBlockTypeHandles=t.showBlockTypeHandles;const e=!s().prefersReducedMotion();switch(this._$spinner=i()(`<div class="ni_spinner">${e?'<div class="spinner"></div>':l().t("neo","Loading")}</div>`),t.newBlockMenuStyle){case"grid":this.ButtonClass=T;break;case"list":this.ButtonClass=w;break;default:this.ButtonClass=C}const n=i()('[name="setId"], [name="entryId"], [name="categoryId"]');n.length&&(this._ownerId=n.val()),this.$container=i()("#"+t.inputId);const o={};this._groups.forEach((t=>{o[t.getId()]=!0}));const r={};for(const e of t.blockTypes)if(null===e.groupId||void 0!==o[e.groupId]){const t=new h(Object.assign({field:this},e));this._blockTypes.push(t),r[t.getHandle()]=t}this.$form=this.$container.closest("form"),this._siteId=this.$form.find('input[name="siteId"]').val();const c=this.$container.find("[data-neo]");if(this.$blocksContainer=c.filter('[data-neo="container.blocks"]'),this.$buttonsContainer=c.filter('[data-neo="container.buttons"]'),this._buttons=new this.ButtonClass({$ownerContainer:this.$container,field:this,blockTypes:this.getBlockTypes(!0),groups:this.getGroups(),maxBlocks:this.getMaxBlocks(),maxTopBlocks:this.getMaxTopBlocks()}),this.$buttonsContainer.append(this._buttons.$container),this._buttons.on("newBlock",(t=>this["@newBlock"](t))),this._buttons.initUi(),this._blockSort=new d({container:this.$blocksContainer,handle:'[data-neo-b$=".button.move"]',maxTopBlocks:this.getMaxTopBlocks(),filter:()=>this._blockSort.$targetItem.hasClass("is-selected")?this.blockSelect.getSelectedItems():this._blockSort.$targetItem,collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9,onDragStart:()=>{this.$form.data("elementEditor")?.pause()},onDragStop:()=>{this.$form.data("elementEditor")?.resume(),this._updateBlockOrder(),this._updateButtons()}}),this.blockSelect=new(s().Select)(this.$blocksContainer,null,{multi:!0,vertical:!0,handle:'> .ni_block_topbar [data-neo-b$=".select"]',checkboxMode:!0,selectedClass:"is-selected sel"}),this.$blocksContainer.find(".ni_block").each(((t,e)=>{const n=i()(e),s={};s.id=n.attr("data-neo-b-id"),s.sortOrder=t,s.collapsed=n.hasClass("is-collapsed"),s.enabled=!!n.find(`[data-neo-b="${s.id}.input.enabled"]`).val(),s.level=parseInt(n.find(`[data-neo-b="${s.id}.input.level"]`).val()),s.field=this,s.namespace=[...this._templateNs,s.id];const o=n.find(`[data-neo-b="${s.id}.input.type"]`).val(),l=r[o];if(void 0===l)return void n.remove();s.blockType=l,s.showButtons=!this.atMaxLevels(s.level);const a=new f(s);a.initUi(!1),this._setBlockEvents(a),n.data("block",a),this._blocks.push(a),this._blockSort.addBlock(a),this.blockSelect.addItems(a.$container)})),this._updateBlockChildren(),this._updateButtons(),this._minBlocks>0){const t=this._minBlocks-this._blocks.length,e=this.getBlockTypes(!0);if(1===e.length&&t>0)for(let t=this._blocks.length;t<this._minBlocks;t++)this["@newBlock"]({blockType:e[0],createChildBlocks:!1,index:t,level:1})}this.addListener(document,"visibilitychange.input",(()=>this._updateButtons())),this.addListener(this.$container,"resize",(()=>this.updateResponsiveness()));const u="function"==typeof this.$form.data("serializer")?this.$form.data("serializer")():this.$form.serialize();this.$form.data("initialSerializedValue",u),this._setMatrixClassErrors(),this._setBlockTypeClassErrors(),this._blocks.filter((t=>!t.isExpanded())).forEach((t=>t.updatePreview())),this._registerDynamicBlockConditions(),this.trigger("afterInit")},getId(){return this._id},getName(){return this._name},updateResponsiveness(){for(const t of this._blocks)t.updateResponsiveness(),t.getButtons()?.updateResponsiveness();this._buttons.updateResponsiveness(),this._tempButtons?.updateResponsiveness()},addBlock(t,e=-1,i=1,n=null,o=!0){this._newBlockCount++,this.$form.data("elementEditor")?.pause();const l=this._blocks.length;e=e>=0?Math.max(0,Math.min(e,l)):l,n=!s().prefersReducedMotion()&&("boolean"!=typeof n||n);const a=e>0&&this._blocks[e-1],r=e<l&&this._blocks[e];if(a){const n=r?r.getLevel():1,s=a.getLevel()+(a.getBlockType().isParent()?1:0);i=Math.max(n,Math.min(i,s));const o=this._findPrevBlockOnLevel(e,i);o?o.$container.after(t.$container):a.$blocksContainer.prepend(t.$container)}else this.$blocksContainer.prepend(t.$container);t.setLevel(i),t.$container.data("block",t),this._blocks.push(t),this._blockSort.addBlock(t),this.blockSelect.addItems(t.$container),t.initUi(),this._setBlockEvents(t),this._destroyTempButtons(),this._updateBlockOrder(),this._updateBlockChildren(),this._updateButtons();const d={};t.$contentContainer.children("[data-layout-tab]").each(((t,e)=>{const i=e.getAttribute("data-layout-tab");d[i]=[],e.querySelectorAll(":scope > [data-layout-element]:not([data-layout-element-placeholder])").forEach((t=>{d[i].push(t.getAttribute("data-layout-element"))}))})),this._visibleLayoutElements[t.getId()]=d;const c=()=>{if(o){const n=t.getBlockType(),s=n.getMinChildBlocks();if(s>0){let t=n.getChildBlocks();if("*"===t&&(t=this.getBlockTypes()),1===t.length){const n=this.getBlockTypeByHandle(t[0]);for(let t=0;t<s;t++)this["@newBlock"]({blockType:n,createChildBlocks:!1,index:e+t+1,level:i+1})}}}this.$form.data("elementEditor")?.resume()};n?t.$container.css({opacity:0,marginBottom:-t.$container.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(e=>s().requestAnimationFrame((()=>{s().scrollContainerToElement(t.$container),c()})))):c(),this.trigger("addBlock",{block:t,index:e})},removeBlock(t,e=null,i=null){this.$form.data("elementEditor")?.pause(),e=!s().prefersReducedMotion()&&("boolean"!=typeof e||e),i="boolean"==typeof i&&i;const n=this._findChildBlocks(this._blocks.indexOf(t));for(const t of n)this.removeBlock(t,!0,!0);t.off(".input"),this._blocks=this._blocks.filter((e=>e!==t)),this._blockSort.removeItems(t.$container),this.blockSelect.removeItems(t.$container),this._destroyTempButtons(),this._updateButtons();const o=()=>{t.$container.remove(),this._updateBlockChildren(),this.$form.data("elementEditor")?.resume()};e?t.$container.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:i?10:-t.$container.outerHeight()},"fast",(t=>o())):o(),t.destroy(),this.trigger("removeBlock",{block:t})},_setBlockEvents(t){t.on("removeBlock.input",(e=>{this.getSelectedBlocks().length>1?window.confirm(l().t("neo","Are you sure you want to delete the selected blocks?"))&&this._blockBatch(t,(t=>this.removeBlock(t))):this.removeBlock(t)})),t.on("toggleEnabled.input",(e=>this._blockBatch(t,(t=>t.toggleEnabled(e.enabled))))),t.on("toggleExpansion.input",(e=>this._blockBatch(t,(t=>t.toggleExpansion(e.expanded))))),t.on("moveUpBlock.input",(e=>this._moveBlock(t,"up"))),t.on("moveDownBlock.input",(e=>this._moveBlock(t,"down"))),t.on("newBlock.input",(e=>this["@newBlock"](Object.assign(e,{index:this._getNextBlockIndex(t)})))),t.on("addBlockAbove.input",(t=>this["@addBlockAbove"](t))),t.on("copyBlock.input",(t=>this["@copyBlock"](t))),t.on("pasteBlock.input",(t=>this["@pasteBlock"](t))),t.on("duplicateBlock.input",(t=>this["@duplicateBlock"](t))),t.on("change.input",(()=>this.trigger("change",{block:t})))},_moveBlock(t,e,i=!0){if(!["up","down"].includes(e))return;this.$form.data("elementEditor")?.pause();const n=t.getSiblings(this.getBlocks()),o=n.indexOf(t),l=o>0&&"up"===e,a=o<n.length-1&&"down"===e;if(-1===o||l===a)return;const r=!s().prefersReducedMotion()&&("boolean"!=typeof i||i),d=t.$container,c=()=>{d.detach(),l?n[o-1].$container.before(d):n[o+1].$container.after(d)},h=()=>{this._updateBlockOrder(),this._updateButtons(),this.$form.data("elementEditor")?.resume()};r?d.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:-d.outerHeight()},"fast",(t=>{c(),d.css({opacity:0,marginBottom:-d.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(t=>{h(),s().requestAnimationFrame((()=>s().scrollContainerToElement(d)))}))})):(c(),h())},getBlockByElement:t=>i()(t).data("block"),getBlocks(t=0){return t>0?this._blocks.filter((e=>e.getLevel()===t)):Array.from(this._blocks)},getBlockTypeById(t){return this._blockTypes.find((e=>e.getId()===t))},getBlockTypeByHandle(t){return this._blockTypes.find((e=>e.getHandle()===t))},getBlockTypes(t){return(t="boolean"==typeof t&&t)?this._blockTypes.filter((t=>t.getTopLevel())):Array.from(this._blockTypes)},getGroups(){return Array.from(this._groups)},getItems(){return[...this.getBlockTypes(),...this.getGroups()].sort(((t,e)=>t.getSortOrder()-e.getSortOrder()))},getMaxBlocks(){return this._maxBlocks},getMaxTopBlocks(){return this._maxTopBlocks},getMinLevels(){return this._minLevels},getMaxLevels(){return this._maxLevels},atMaxLevels(t){return this._maxLevels>0&&t+1>this._maxLevels},getSelectedBlocks(){const t=this.blockSelect.getSelectedItems();return this._blocks.filter((e=>e.$container.closest(t).length>0))},getCopiedBlocks(){const t=window.localStorage.getItem(`neo:copy:${this._name}`);if(!t)return[];const{blocks:e}=JSON.parse(t);return e},setVisibleElements(t,e){"string"==typeof e&&(e=JSON.parse(e));null!==this._blocks.find((e=>e.getId()===t))&&(this._visibleLayoutElements[t]=e)},getNamespace(){return Array.from(this._templateNs)},getOwnerId(){return this._ownerId},getSiteId(){return this._siteId},_setMatrixClassErrors(){i()(".ni_block_body .matrix-field .input.errors").each((function(){const t=i()(this),e=t.closest(".ni_block_content_tab").data("neo-b-info"),n=t.closest(".ni_block").find('.tabs .tab[data-neo-b-info="'+e+'"]');n.length&&n.addClass("has-errors")}))},_setBlockTypeClassErrors(){const t=i()(".ni_block .tab.has-errors");t.each((function(){t.parents(".ni_block.is-collapsed").each((function(){i()(this).find("> .ni_block_topbar .title .blocktype").addClass("has-errors")}))}))},_updateBlockOrder(){const t=[];this.$blocksContainer.find(".ni_block").each(((e,i)=>{const n=this.getBlockByElement(i);t.push(n)})),this._blocks=t,this.trigger("updateBlockOrder"),this.trigger("change",{block:null})},_updateBlockChildren(){for(const t of this._blocks){const e=t.$blocksContainer.children(".ni_block"),i=Math.min(e.length,8),n=[];for(let t=0;t<i;t++)n.push('<div class="ni_block_collapsed-children_child"></div>');t.$collapsedChildrenContainer.html(n.join(""))}},_checkMaxChildren(t){if(!t)return!0;const e=t.getBlockType().getMaxChildBlocks();if(e>0){return this._findChildBlocks(t).length<e}return!0},_updateButtons(){const t=this.getBlocks();this._buttons.updateButtonStates(t),this._tempButtons?.updateButtonStates(t,this._checkMaxChildren(this._tempButtonsBlock));for(const e of t)e.updateActionsMenu(),e.getButtons()?.updateButtonStates(t,this._checkMaxChildren(e),e),e.toggleShowButtons(!this.atMaxLevels(e.getLevel()))},_blockBatch(t,e){const i=t.isSelected()?this.getSelectedBlocks():[t];for(const t of i)e(t)},_destroyTempButtons(t=null){if(t=!s().prefersReducedMotion()&&("boolean"!=typeof t||t),this._tempButtons){const e=this._tempButtons;e.off("newBlock"),t?e.$container.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:-e.$container.outerHeight()},"fast",(t=>e.$container.remove())):e.$container.remove(),this._tempButtons=null,this._tempButtonsBlock=null}},_findPrevBlockOnLevel(t,e){t instanceof f&&(t=this._blocks.indexOf(t));let i=this._blocks[--t],n=Number.MAX_VALUE;for(;i;){const s=i.getLevel();if(s<n){if(s===e)return i;n=s}i=this._blocks[--t]}return!1},_findChildBlocks(t,e=null){t instanceof f&&(t=this._blocks.indexOf(t)),e="boolean"==typeof e&&e;const i=this._blocks[t];return i?i.getChildren(this._blocks,e):[]},_findParentBlock(t){t instanceof f&&(t=this._blocks.indexOf(t));const e=this._blocks,i=e[t];if(i){const n=i.getLevel();if(n>1){let s=t,o=i;for(;o&&o.getLevel()>=n;)o=e[--s];return o}}return null},_getNextBlockIndex(t){if(void 0===t)return 0;t instanceof f&&(t=this._blocks.indexOf(t));const e=this._findChildBlocks(t,!0),i=e[e.length-1];return(i?this._blocks.indexOf(i):t)+1},_registerDynamicBlockConditions(){setTimeout((()=>this.$form.data("elementEditor")?.on("update",(()=>this._updateAllVisibleElements()))),200)},async _updateAllVisibleElements(){const t=Math.floor(1e6*Math.random());this._lastFormCheck=t;const e=this.$form.data("elementEditor");if(e?.submittingForm??1)return;if(this._newBlockCount>0)return void this._newBlockCount--;const i=e.settings.siteId;a.enter(this.getNamespace());const n={namespace:a.toFieldName(),blocks:{},sortOrder:[],blockUuids:[],fieldId:this._id,ownerCanonicalId:this._ownerId,ownerDraftId:e.settings.draftId,isProvisionalDraft:e.settings.isProvisionalDraft,siteId:i};a.leave();const s={};this._blocks.forEach((t=>{const e=t.$contentContainer.children("[data-layout-tab]:not(.hidden)").data("layout-tab");n.blocks[t.getDuplicatedBlockId()]={selectedTab:e??null,visibleLayoutElements:this._visibleLayoutElements[t.getId()]??{}},n.sortOrder.push(t.getDuplicatedBlockId()),n.blockUuids.push(t.getUuid()),s[t.getDuplicatedBlockId()]=t.getId()}));try{const e=await l().sendActionRequest("POST","neo/input/update-visible-elements",{data:n});if(this._lastFormCheck!==t)return;for(const t in e.data.blocks){const i=this._blocks.find((e=>e.getId()===s[t]));this._updateVisibleElements(i,e.data.blocks[t],n.blocks[i.getDuplicatedBlockId()].selectedTabId)}}catch(t){throw l().cp.displayError(t),t}},_updateVisibleElements(t,e,n){let o=i()();const a={};let r=!1;for(let d=0;d<e.missingElements.length;d++){const c=e.missingElements[d];let h=t.$contentContainer.children(`[data-layout-tab="${c.uid}"]`);h.length||(h=i()("<div/>",{id:t.namespaceId(c.id),class:"flex-fields","data-id":c.id,"data-layout-tab":c.uid}),c.id!==n&&h.addClass("hidden"),h.appendTo(t.$contentContainer)),o=o.add(h);for(let e=0;e<c.elements.length;e++){const n=c.elements[e];if(!1!==n.html){if(a[c.uid]||(a[c.uid]=[]),a[c.uid].push(n.uid),"string"==typeof n.html){const e=n.html.replaceAll("__NEOBLOCK__",t.getId()),s=h.children(`[data-layout-element="${n.uid}"]`),o=i()(e);s.length?s.replaceWith(o):o.appendTo(h),l().initUiElements(o),o.hasClass("ni_child-blocks-ui-element")&&t.resetButtons(),r=!0}}else{const t=h.children(`[data-layout-element="${n.uid}"]`);if(!t.length||!s().hasAttr(t,"data-layout-element-placeholder")){const e=i()("<div/>",{class:"hidden","data-layout-element":n.uid,"data-layout-element-placeholder":""});t.length?t.replaceWith(e):e.appendTo(h),r=!0}}}r&&this._updateButtons()}const d=t.$contentContainer.children("[data-layout-tab]").not(o).not('[data-layout-tab=""]');d.length&&(d.remove(),r=!0),o.filter(":not(.hidden)").length||o.first().removeClass("hidden"),this._visibleLayoutElements[t.getId()]=a;const c=e.tabs?.match(/data-neo-b="([0-9]+).container.tabs"/)?.pop()??null,h=c?e.tabs.replaceAll(c,t.getId()):e.tabs,u=i()(h);t.$topbarRightContainer.find(".tabs").empty().append(u),t.initTabs(),t.updateResponsiveness(),l().appendHeadHtml(e.headHtml.replaceAll("__NEOBLOCK__",t.getId())),l().appendBodyHtml(e.bodyHtml.replaceAll("__NEOBLOCK__",t.getId())),r&&e.initialDeltaValues&&Object.assign(this.$form.data("initial-delta-values"),e.initialDeltaValues)},_addSpinnerAfter(t){void 0!==t?t.$container.after(this._$spinner):this.$blocksContainer.prepend(this._$spinner),this._animateSpinner()},_addSpinnerBefore(t){void 0!==t?t.$container.before(this._$spinner):this.$blocksContainer.append(this._$spinner),this._animateSpinner()},_animateSpinner(){return s().prefersReducedMotion()?Promise.resolve():new Promise(((t,e)=>{try{this._$spinner.css({opacity:0,marginBottom:-this._$spinner.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(()=>t()))}catch(t){e(t)}}))},_removeSpinner(){this._$spinner.remove()},async _duplicate(t,e){try{this.$form.data("elementEditor")?.pause(),await this._addSpinnerAfter(e);const i=await l().sendActionRequest("POST","neo/input/render-blocks",{data:t}),n=[];for(const t of i.data.blocks){const e=t.id,i=new f({namespace:[...this._templateNs,e],field:this,blockType:this.getBlockTypeById(t.type),blockHtml:t.blockHtml,bodyHtml:t.bodyHtml,headHtml:t.headHtml,id:e,uuid:t.uuid,level:0|t.level,enabled:!!t.enabled,collapsed:!!t.collapsed,showButtons:!this.atMaxLevels(0|t.level),showBlockTypeHandle:this._showBlockTypeHandles},!0);n.push(i)}let o=this._getNextBlockIndex(e);for(const t of n)this.addBlock(t,o++,t.getLevel(),!1);if(!s().prefersReducedMotion()&&n.length>0){const t=n[0];t.$container.css({opacity:0,marginBottom:this._$spinner.outerHeight()-t.$container.outerHeight()+10}).velocity({opacity:1,marginBottom:10},"fast",(e=>s().requestAnimationFrame((()=>s().scrollContainerToElement(t.$container)))))}}catch(t){l().cp.displayError(t.message)}finally{this._removeSpinner(),this.$form.data("elementEditor")?.resume()}},async"@newBlock"(t){const e=this.$form.data("elementEditor");try{e?.pause();const i=t.level??1,n=void 0!==t.index?Math.min(t.index-1,this._blocks.length-1):this._blocks.length-1;let s,o=!0;for(let t=n;t>=0;t--){if(this._blocks[t].getLevel()===i){s=this._blocks[t];break}if(this._blocks[t].getLevel()<i){s=this._blocks[t+1],o=!1;break}}o?await this._addSpinnerAfter(s):await this._addSpinnerBefore(s);const l=o?s?.getDuplicatedBlockId():null,a=s?.getParent()?.getDuplicatedBlockId()??null,r=await t.blockType.newBlock({prevSiblingId:l??null,parentId:a,level:i,ownerId:e?.settings.elementId??this._ownerId}),d=r.id,c=new f({namespace:[...this._templateNs,d],field:this,blockType:t.blockType,id:d,uuid:r.uuid,blockHtml:r.blockHtml,bodyHtml:r.bodyHtml,headHtml:r.headHtml,showButtons:!this.atMaxLevels(t.level),showBlockTypeHandle:this._showBlockTypeHandles},!0);this._removeSpinner(),this.addBlock(c,t.index,t.level,t.createChildBlocks,t.createChildBlocks)}catch(t){this._removeSpinner(),console.error(t),l().cp.displayError(t.message)}finally{e?.resume()}},"@addBlockAbove"(t){this._destroyTempButtons();const e=!s().prefersReducedMotion()&&!1!==t.animate,i=t.block,n=this._blocks.indexOf(i),o=this._findParentBlock(n),l=this.getBlocks(),a=new this.ButtonClass({$ownerContainer:i.isTopLevel()?this.$container:i.getParent().$container,field:this,blockTypes:o?[]:this.getBlockTypes(!0),blocks:l,groups:o?[]:this.getGroups(),items:o?o.getBlockType().getChildBlockItems(this.getItems()):null,maxBlocks:this.getMaxBlocks()});i.$container.before(a.$container),a.on("newBlock",(t=>this["@newBlock"]({blockType:t.blockType,index:n,level:i.getLevel()}))),a.initUi(),e&&a.$container.css({opacity:0,marginBottom:-a.$container.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(t=>s().requestAnimationFrame((()=>s().scrollContainerToElement(a.$container))))),this._tempButtons=a,this._tempButtonsBlock=this._findParentBlock(i),this._tempButtons.updateButtonStates(l,this._checkMaxChildren(this._tempButtonsBlock),this._tempButtonsBlock)},"@copyBlock"(t){const e=[];let i=0;this._blockBatch(t.block,(t=>{if(!(i>0&&-1!==e[e.length-1].indexOf(t))){const n=[];n.push(t,...this._findChildBlocks(t,!0)),e.push(n),i+=n.length}}));const n={field:this._name,blocks:[]};for(const t of e){const e=t[0].getLevel()-1;for(const i of t){const t={type:i.getBlockType().getId(),level:i.getLevel()-e,content:i.getContent()};i.isEnabled()&&(t.enabled=1),i.isExpanded()||(t.collapsed=1),n.blocks.push(t)}}window.localStorage.setItem(`neo:copy:${this._name}`,JSON.stringify(n)),this._updateButtons();const s=1===i?"1 block copied":"{n} blocks copied";l().cp.displayNotice(l().t("neo",s,{n:i}))},"@pasteBlock"(t){const e=t.block,i=(e?.getLevel()??1)-1,n=this.getCopiedBlocks();if(n.length>0){for(const t of n)t.level+=i,t.ownerId=this._ownerId;a.enter(this._templateNs);const t={namespace:a.toFieldName(),fieldId:this._id,siteId:this._siteId,blocks:n};a.leave(),this._duplicate(t,e)}},"@duplicateBlock"(t){const e=t.block,i=this._blocks.indexOf(e),n=this._findChildBlocks(i,!0),s=this._ownerId,o=t=>({collapsed:0|!t.isExpanded(),content:t.getContent(),enabled:0|t.isEnabled(),level:t.getLevel(),ownerId:s,type:t.getBlockType().getId()});a.enter(this._templateNs);const l={namespace:a.toFieldName(),fieldId:this._id,siteId:this._siteId,blocks:[o(e),...n.map(o)]};a.leave(),this._duplicate(l,e)}}),O=window??void 0,N=[];O.Neo={Input:E,inputs:N,createInput(t={}){const e=new E(t);return N.push(e),e}}})();
//# sourceMappingURL=input.js.map